<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>hiho1036 | Young&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1036 : Trie图

时间限制:10000ms单点时限:1000ms内存限制:512MB描述上回说到，小Hi和小Ho接受到了河蟹先生伟大而光荣的任务：河蟹先生将要给与他们一篇从互联网上收集来的文章，和一本厚厚的河蟹词典，而他们要做的是判断这篇文章中是否存在那些属于河蟹词典中的词语。
当时，小Hi和小Ho的水平还是十分有限，他们只能够想到：“枚举每一个单词，然后枚举文章中可能的起始位置，然后进">
<meta property="og:type" content="article">
<meta property="og:title" content="hiho1036">
<meta property="og:url" content="http://youngyangyang.com/2015/05/14/hiho1036/">
<meta property="og:site_name" content="Young's blog">
<meta property="og:description" content="1036 : Trie图

时间限制:10000ms单点时限:1000ms内存限制:512MB描述上回说到，小Hi和小Ho接受到了河蟹先生伟大而光荣的任务：河蟹先生将要给与他们一篇从互联网上收集来的文章，和一本厚厚的河蟹词典，而他们要做的是判断这篇文章中是否存在那些属于河蟹词典中的词语。
当时，小Hi和小Ho的水平还是十分有限，他们只能够想到：“枚举每一个单词，然后枚举文章中可能的起始位置，然后进">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hiho1036">
<meta name="twitter:description" content="1036 : Trie图

时间限制:10000ms单点时限:1000ms内存限制:512MB描述上回说到，小Hi和小Ho接受到了河蟹先生伟大而光荣的任务：河蟹先生将要给与他们一篇从互联网上收集来的文章，和一本厚厚的河蟹词典，而他们要做的是判断这篇文章中是否存在那些属于河蟹词典中的词语。
当时，小Hi和小Ho的水平还是十分有限，他们只能够想到：“枚举每一个单词，然后枚举文章中可能的起始位置，然后进">

  
    <link rel="alternative" href="/atom.xml" title="Young&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Young&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">哀吾生之须臾，羡长江之无穷</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
	  
	<!-- 使用swiftype自定义搜索 -->
	  
		<div id="search-form-wrap">
		<form class="search-form">
			<input type="text" id="st-search-input" class="search-form-input" placeholder="Search" />
			<input type="submit" value="" class="search-form-submit"> 
		</form>		
	</div>
	  	

    </div>
  </div>
  
<!-- 从Swiftype官网粘贴安装代码到下面，使用overlay的needs a search field类型 -->


	<!-- 此处Swiftype搜索代码 -->
          
  

</header>
      <div class="outer">
        <section id="main"><article id="post-hiho1036" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/14/hiho1036/" class="article-date">
  <time datetime="2015-05-14T03:06:02.000Z" itemprop="datePublished">5月 14 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/一起刷hihocoder/">一起刷hihocoder</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      hiho1036
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1036_:_Trie图">1036 : Trie图</h2>
<hr>
<p>时间限制:10000ms<br>单点时限:1000ms<br>内存限制:512MB<br><strong>描述</strong><br>上回说到，小Hi和小Ho接受到了河蟹先生伟大而光荣的任务：河蟹先生将要给与他们一篇从互联网上收集来的文章，和一本厚厚的河蟹词典，而他们要做的是判断这篇文章中是否存在那些属于河蟹词典中的词语。</p>
<p>当时，小Hi和小Ho的水平还是十分有限，他们只能够想到：“枚举每一个单词，然后枚举文章中可能的起始位置，然后进行匹配，看能否成功。”这样非常朴素的想法，但是这样的算法时间复杂度是相当高的，如果说词典的词语数量为N，每个词语长度为L，文章的长度为M，那么需要进行的计算次数是在N<em>M</em>L这个级别的，而这个数据在河蟹先生看来是不能够接受的。</p>
<p>于是河蟹先生决定先给他们个机会学习一下，于是给出了一个条件N=1，也就是说词典里面事实上只有一个词语，但是希望他们能够统计这个词语在文章中出现的次数，这便是我们常说的模式匹配问题。而小Hi和小Ho呢，通过这一周的努力，学习钻研了KMP算法，并在互相帮助之下，已经成功的解决掉了这个问题！</p>
<p>这便是Hiho一下第三周发生的事情，而现在第四周到了，小Hi和小Ho也要踏上解决真正难题的旅程了呢！</p>
<p>小Hi和小Ho是一对好朋友，出生在信息化社会的他们对编程产生了莫大的兴趣，他们约定好互相帮助，在编程的学习道路上一同前进。</p>
<p>这一天，他们……咳咳，说远了，且说小Ho好不容易写完了第三周程序，却发现自己错过了HihoCoder上的提交日期，于是找小Hi哭诉，小Hi虽然身为管理员，但是也不好破这个例，于是把小Ho赶去题库交了代码，总算是哄好了小Ho。</p>
<p>小Ho交完程序然后屁颠屁颠的跑回了小Hi这边，问道：“小Hi，你说我们是不是可以去完成河蟹大大的任务了呢？”</p>
<p>小Hi思索半天，道：“老夫夜观星象……啊不，我这两天查阅了很多资料，发现这个问题其实也是很经典的问题，早在06年就有信息学奥林匹克竞赛国家集训队的论文中详详细细的分析了这一问题，而他们使用的就是Trie图这样一种数据结构！”</p>
<p>“Trie图？是不是和我们在第二周遇到的那个Trie树有些相似呀？”小Ho问道。</p>
<p>“没错！Trie图就是在Trie树的基础上发展成的一种数据结构。如果要想用一本词典构成Trie图的话，那么就首先要用这本词典构成一棵Trie树，然后在Trie树的基础上添加一些边，就能够变成Trie图了！”小Hi又作老师状。</p>
<p>“哦！但是你说了这么多，我都不知道Trie图是什么样的呢！”小Ho无奈道。</p>
<p>“也是！那我们还是从头开始，先讲讲怎么用Trie树来解决这个问题，然后在Trie树的基础上，讨论下一步应该如何。”小Hi想了想说道。</p>
<p>提示一：如何用Trie树进行“河蟹”</p>
<p>“现在我们有了一个时间复杂度在O(ML)级别的方法，但是我们的征途在星辰大海，啊不，我们不能满足于这样一个60分的方法。所以呢，我们还是要贯彻我们一贯的做法，寻找在这个算法中那些冗余的计算！“小Hi道：”那么我们现在来看看Trie树进行计算的时候都发生了些什么。”</p>
<p>提示二：Trie树的优化思路——后缀结点</p>
<p>“那么现在……”小Hi刚要开口，就被小Ho无情打断。</p>
<p>“可是小Hi老师~你看在这种情况下，结点C找不到对应的后缀结点，它对应的路径是aaabc，而aabc在Trie里面是走不出来的！”小Ho手中挥舞着一张纸，问道。</p>
<p>“你个瓜娃子，老是拆老子台做啥子！……阿不，小Ho你别担心，我这就要讲解如何求后缀结点呢~”小Hi笑容满面的说道。</p>
<p>提示三：如何求解Trie树中每个结点的后缀结点</p>
<p>“原来如此！这样我就知道了每一个结点的后缀结点了，接下来我就可以很轻松的解决河蟹先生交给我的问题了呢！”小Ho高兴的说道：“但是，说好的Trie图在哪里呢？”</p>
<p>小Hi不由笑道：“你这叫买椟还珠你知道么？还记得我们再计算后缀结点的时候计算出的从每个点出发，经由每一个char（比如’a’..’d’）会走到的结点么？把这些边添加到Trie树上，就是Trie图了！”</p>
<p>“原来是这样，但是这些边感觉除了计算后缀结点之外，没有什么用处呀？”小Ho又开始问问题了。</p>
<p>“这就是Trie图的巧妙之处了，你想想你什么时候需要知道一个结点的后缀结点？”小Hi实在不忍看自己的兄弟这般呆萌，只能耐着性子解释。</p>
<p>小Ho顿时恍然大悟，“在这个结点不能够继续和文章str继续匹配了的时候，也就是这个结点没有“文章的下一个字符”对应的那条边，哦！我知道了，在Trie图中，每个结点都补全了所有的边，所以原来需要先找到后缀结点再根据“str的下一个字符”这样一条边找到下一个结点，现在可以直接通过当前结点的“str的下一个字符”这样一条边就可以接着往下匹配了，如果本来是有这条边的，那不用多说，而如果这条边是根据后缀结点补全的，那便是我们想要的结果！”</p>
<p>“所以呢！完成这个任务的方法总的来说就是这样，先根据字典构建一棵Trie树，然后根据我们之前所说的构建出对应的Trie图，然后从Trie图的根节点开始，沿着文章str的每一个字符，走出对应的边，直到遇到一个标记结点或者整个str都已经匹配完成了~”小Hi适时的总结道。</p>
<p>“而这样的时间复杂度则在O(NL+M)级别的呢！想来是足以完成河蟹先生的要求了呢~”小Ho搬了搬手指，说道。</p>
<p>“是的！但是河蟹先生要求的可不是想法哦，他可是希望我们写出程序给它呢！”</p>
<p><strong>输入</strong></p>
<p>每个输入文件有且仅有一组测试数据。</p>
<p>每个测试数据的第一行为一个整数N，表示河蟹词典的大小。</p>
<p>接下来的N行，每一行为一个由小写英文字母组成的河蟹词语。</p>
<p>接下来的一行，为一篇长度不超过M，由小写英文字母组成的文章。</p>
<p>对于60%的数据，所有河蟹词语的长度总和小于10, M&lt;=10</p>
<p>对于80%的数据，所有河蟹词语的长度总和小于10^3, M&lt;=10^3</p>
<p>对于100%的数据，所有河蟹词语的长度总和小于10^6, M&lt;=10^6, N&lt;=1000</p>
<p><strong>输出</strong><br>对于每组测试数据，输出一行”YES”或者”NO”，表示文章中是否含有河蟹词语。</p>
<p><strong>样例输入</strong></p>
<blockquote>
<p>6<br>aaabc<br>aaac<br>abcc<br>ac<br>bcd<br>cd<br>aaaaaaaaaaabaaadaaac</p>
</blockquote>
<p><strong>样例输出</strong></p>
<blockquote>
<p>YES</p>
</blockquote>
<h2 id="分析">分析</h2>
<p>好久没有更新了，因为五月初一直在忙着准备面试，然后终于过了一个，六月份就要入职了。再加上机器学习的班又开课了，所以打乱了自己的计划。<br>再加上这道题好难……其实这道题是很著名的AC自动机，刘汝佳的《算法竞赛入门经典：训练指南》里有，但是讲的有点简单了。小hi和小ho讲的又太罗嗦了，完全看不懂啊摔。<br>于是乎我必应了一下，找到了这个<a href="http://www.cppblog.com/mythit/archive/2009/04/21/80633.html" target="_blank" rel="external">AC自动机算法详解</a>。ps：百度得到的结果真不给力啊。<br>AC自动机最重要的部分就是构造失败指针，而构造失败指针的过程就是一句话：<strong>在bfs的过程中，设这个节点上的字母为C，沿着他父亲的失败指针走，直到走到一个节点，他的儿子中也有字母为C的节点。然后把当前节点的失败指针指向那个字母也为C的儿子。如果一直走到了root都没找到，那就把失败指针指向root。</strong><br>后面就是类似kmp算法的不停地比较了。总而言之，AC自动机其实就是Trie树和kmp的综合。<br>但是我的代码有点慢，原因可能是因为构造和搜索过于复杂了吧，所以把一个十佳代码也放上来参考一下。</p>
<p>根据这个思路可以得到以下的代码（我的）</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;map&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;queue&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> num = <span class="number">0</span>;</div><div class="line"><span class="keyword">struct</span> node{</div><div class="line">	<span class="keyword">char</span> mychar;</div><div class="line">	<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, node*&gt;</span> mychildren;</div><div class="line">	<span class="keyword">bool</span> mark;</div><div class="line">	node * fail;</div><div class="line">	<span class="comment">//node * father;</span></div><div class="line">	<span class="keyword">int</span> n;</div><div class="line">	node(){</div><div class="line">		fail = NULL;</div><div class="line">		<span class="comment">//father = NULL;</span></div><div class="line">		mychar = <span class="string">' '</span>;</div><div class="line">		mychildren.clear();</div><div class="line">		mark = <span class="keyword">false</span>;</div><div class="line">		n = num++;</div><div class="line">	}</div><div class="line">};</div><div class="line"><span class="keyword">void</span> constructtree(node *cur, <span class="keyword">const</span> <span class="built_in">string</span> & str, <span class="keyword">int</span> index)</div><div class="line">{</div><div class="line">	<span class="keyword">char</span> curchar = str[index];</div><div class="line">	<span class="keyword">if</span> (cur-&gt;mychildren.count(curchar) == <span class="number">0</span>)</div><div class="line">	{<span class="comment">//还没有这个字母</span></div><div class="line">		node * next = <span class="keyword">new</span> node;</div><div class="line">		next-&gt;mychar = curchar;</div><div class="line">	<span class="comment">//	next-&gt;father = cur;</span></div><div class="line">		cur-&gt;mychildren[curchar] = next;</div><div class="line">		cur = next;</div><div class="line">	}</div><div class="line">	<span class="keyword">else</span></div><div class="line">	{</div><div class="line">		cur = cur-&gt;mychildren[curchar];</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span> (index == str.size() - <span class="number">1</span>)</div><div class="line">	{</div><div class="line">		cur-&gt;mark = <span class="keyword">true</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">else</span></div><div class="line">	{</div><div class="line">		constructtree(cur, str, index+<span class="number">1</span>);</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="keyword">void</span> destructtree(node *cur)</div><div class="line">{</div><div class="line">	<span class="keyword">for</span> (<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, node *&gt;</span>::iterator iter = cur-&gt;mychildren.begin(); iter != cur-&gt;mychildren.end(); iter++)</div><div class="line">		destructtree(iter-&gt;second);</div><div class="line">	<span class="keyword">delete</span> cur;</div><div class="line">}</div><div class="line"><span class="keyword">void</span> dfs(node *cur)</div><div class="line">{</div><div class="line">	<span class="keyword">for</span> (<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, node*&gt;</span>::iterator iter = cur-&gt;mychildren.begin(); iter != cur-&gt;mychildren.end(); iter++)</div><div class="line">	{</div><div class="line">		dfs(iter-&gt;second);</div><div class="line">	}</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; cur-&gt;mychar &lt;&lt; <span class="string">"-&gt;"</span> &lt;&lt; cur-&gt;n &lt;&lt; <span class="string">"-&gt;"</span>;</div><div class="line">	<span class="keyword">if</span> (cur-&gt;mark)</div><div class="line">	{</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"YES"</span> &lt;&lt; endl;</div><div class="line">	}</div><div class="line">	<span class="keyword">else</span></div><div class="line">	{</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"NO"</span> &lt;&lt; endl;</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="stl_container"><span class="built_in">queue</span>&lt;node *&gt;</span> myqueue;</div><div class="line"><span class="keyword">int</span> main()</div><div class="line">{</div><div class="line">	<span class="comment">//构造trie图</span></div><div class="line">	<span class="keyword">int</span> n;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n;</div><div class="line">	node *head = <span class="keyword">new</span> node;</div><div class="line">	head-&gt;fail = NULL;</div><div class="line">	<span class="comment">//head-&gt;father = head;</span></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">	{</div><div class="line">		<span class="built_in">string</span> str;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; str;</div><div class="line">		constructtree(head, str, <span class="number">0</span>);</div><div class="line">	}</div><div class="line">	<span class="comment">//ac自动机的构造</span></div><div class="line">	myqueue.push(head);</div><div class="line">	<span class="keyword">while</span> (!myqueue.empty())</div><div class="line">	{</div><div class="line">		node *cur = myqueue.front();</div><div class="line">		myqueue.pop();</div><div class="line">		<span class="keyword">for</span> (<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, node*&gt;</span>::iterator iter = cur-&gt;mychildren.begin(); iter != cur-&gt;mychildren.end(); iter++)</div><div class="line">		{</div><div class="line">			myqueue.push(iter-&gt;second);</div><div class="line">			node *father = cur;</div><div class="line">			<span class="keyword">while</span> (father != head)</div><div class="line">			{</div><div class="line">				<span class="keyword">if</span> (father-&gt;fail-&gt;mychildren.count(iter-&gt;first) != <span class="number">0</span>)</div><div class="line">				{</div><div class="line">					iter-&gt;second-&gt;fail = father-&gt;fail-&gt;mychildren[iter-&gt;first];</div><div class="line">					<span class="keyword">if</span> (father-&gt;fail-&gt;mychildren[iter-&gt;first]-&gt;mark)</div><div class="line">					{</div><div class="line">						iter-&gt;second-&gt;mark = <span class="keyword">true</span>;</div><div class="line">					}</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				}</div><div class="line">				<span class="keyword">else</span></div><div class="line">				{</div><div class="line">					father = father-&gt;fail;</div><div class="line">				}</div><div class="line">			}</div><div class="line">			<span class="keyword">if</span> (father == head)</div><div class="line">			{</div><div class="line">				iter-&gt;second-&gt;fail = head;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//dfs(head);</span></div><div class="line">	<span class="built_in">string</span> str;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; str;</div><div class="line">	<span class="keyword">bool</span> found = <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">	node * cur = head;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++)</div><div class="line">	{</div><div class="line">		<span class="keyword">if</span> (cur == NULL)</div><div class="line">		{</div><div class="line">			cur = head;</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span> (cur == head && cur-&gt;mychildren.count(str[i])==<span class="number">0</span>)</div><div class="line">		{</div><div class="line">			<span class="keyword">continue</span>;</div><div class="line">		}</div><div class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>)</div><div class="line">		{</div><div class="line">			<span class="keyword">if</span> (cur-&gt;mychildren.count(str[i]) != <span class="number">0</span>)</div><div class="line">			{</div><div class="line">				cur = cur-&gt;mychildren[str[i]];</div><div class="line">				<span class="keyword">if</span> (cur-&gt;mark)</div><div class="line">				{</div><div class="line">					found = <span class="keyword">true</span>;</div><div class="line">					<span class="keyword">goto</span> part2;</div><div class="line">				}</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			}</div><div class="line">			<span class="keyword">else</span></div><div class="line">				cur = cur-&gt;fail;</div><div class="line">			<span class="keyword">if</span> (cur == NULL)</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	part2:</div><div class="line">	<span class="keyword">if</span> (found)</div><div class="line">	{</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"YES"</span> &lt;&lt; endl;</div><div class="line">	}</div><div class="line">	<span class="keyword">else</span></div><div class="line">	{</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"NO"</span> &lt;&lt; endl;</div><div class="line">	}</div><div class="line">	<span class="comment">//回收空间</span></div><div class="line">	destructtree(head);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>十佳代码，当然这个scanf在VS2013跑不起来，需要scanf_s。</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;cstring&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;cstdio&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;queue&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">struct</span> Trie{</div><div class="line">	<span class="keyword">bool</span> isdan;</div><div class="line">	<span class="keyword">int</span> link[<span class="number">26</span>];</div><div class="line">	<span class="keyword">int</span> pre;</div><div class="line">}T[<span class="number">1000010</span>];</div><div class="line"><span class="keyword">int</span> Count = <span class="number">1</span>;</div><div class="line"><span class="keyword">char</span> s[<span class="number">1000010</span>], p[<span class="number">1000010</span>];</div><div class="line"><span class="stl_container"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;</span> q;</div><div class="line"><span class="keyword">void</span> build_trie(<span class="keyword">int</span> len)</div><div class="line">{</div><div class="line">	<span class="keyword">int</span> pos = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;len; i++){</div><div class="line">		<span class="keyword">if</span> (T[pos].link[p[i] - <span class="string">'a'</span>] == -<span class="number">1</span>){</div><div class="line">			T[pos].link[p[i] - <span class="string">'a'</span>] = ++Count;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;<span class="number">26</span>; j++) T[Count].link[j] = -<span class="number">1</span>;</div><div class="line">			T[Count].isdan = <span class="keyword">false</span>;</div><div class="line">		}</div><div class="line">		pos = T[pos].link[p[i] - <span class="string">'a'</span>];</div><div class="line">		<span class="keyword">if</span> (i == len - <span class="number">1</span>) T[pos].isdan = <span class="keyword">true</span>;</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="keyword">void</span> build_G()</div><div class="line">{</div><div class="line">	q.push(<span class="number">1</span>);</div><div class="line">	<span class="keyword">while</span> (!q.empty()){</div><div class="line">		<span class="keyword">int</span> proot = q.front();</div><div class="line">		q.pop();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">26</span>; i++){</div><div class="line">			<span class="keyword">int</span> child = T[proot].link[i];</div><div class="line">			<span class="keyword">if</span> (child != -<span class="number">1</span>){</div><div class="line">				<span class="keyword">int</span> ppre = T[proot].pre;</div><div class="line">				<span class="keyword">while</span> (ppre != -<span class="number">1</span>){</div><div class="line">					<span class="keyword">if</span> (T[ppre].link[i] != -<span class="number">1</span>){</div><div class="line">						T[child].pre = T[ppre].link[i];</div><div class="line">						<span class="keyword">if</span> (T[T[child].pre].isdan) T[child].isdan = <span class="keyword">true</span>;</div><div class="line">						<span class="keyword">break</span>;</div><div class="line">					}</div><div class="line">					<span class="keyword">else</span> ppre = T[ppre].pre;</div><div class="line">				}</div><div class="line">				q.push(child);</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="keyword">bool</span> solve()</div><div class="line">{</div><div class="line">	<span class="keyword">int</span> pos = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; i++){</div><div class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>){</div><div class="line">			<span class="keyword">if</span> (T[pos].link[s[i] - <span class="string">'a'</span>] != -<span class="number">1</span>){</div><div class="line">				pos = T[pos].link[s[i] - <span class="string">'a'</span>];</div><div class="line">				<span class="keyword">if</span> (T[pos].isdan) <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			}</div><div class="line">			<span class="keyword">else</span> pos = T[pos].pre;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> main()</div><div class="line">{</div><div class="line">	<span class="keyword">int</span> n;</div><div class="line">	scanf_s(<span class="string">"%d"</span>, &n);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;<span class="number">26</span>; j++) T[<span class="number">1</span>].link[j] = -<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++){</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>, p);</div><div class="line">		build_trie(<span class="built_in">strlen</span>(p));</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">26</span>; i++) T[<span class="number">0</span>].link[i] = <span class="number">1</span>;</div><div class="line">	T[<span class="number">1</span>].pre = <span class="number">0</span>; T[<span class="number">0</span>].pre = -<span class="number">1</span>; T[<span class="number">0</span>].isdan = <span class="keyword">false</span>;</div><div class="line">	build_G();</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">	scanf_s(<span class="string">"%s"</span>, s);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (solve()) <span class="built_in">printf</span>(<span class="string">"YES\n"</span>);</div><div class="line">	<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"NO\n"</span>);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
	  
	  
		<a href="#logo" class="article-top-link">返回顶部</a>
      
	  
      
        <a data-url="http://youngyangyang.com/2015/05/14/hiho1036/" data-id="nzyblauv0px9ugz0" data-title="hiho1036 | Young&#39;s blog" data-weibo-id="" class="article-share-link">分享到</a>
      
		
      
        <a href="http://youngyangyang.com/2015/05/14/hiho1036/#ds-thread" class="article-comment-link">Comments</a>
      
	  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hihocoder/">hihocoder</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/05/15/hiho1037/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          hiho1037
        
      </div>
    </a>
  
  
    <a href="/2015/04/30/hiho1032/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">hiho1032</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2015/05/14/hiho1036/" data-title="hiho1036" data-url="http://youngyangyang.com/2015/05/14/hiho1036/"></div>
  </section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DataMining-MachineLearning/">DataMining&MachineLearning</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/booklist/">booklist</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/一起刷hihocoder/">一起刷hihocoder</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活点滴/">生活点滴</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/books/">books</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hihocoder/">hihocoder</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据挖掘/">数据挖掘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活记录/">生活记录</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/books/" style="font-size: 13.33px;">books</a><a href="/tags/hihocoder/" style="font-size: 20.00px;">hihocoder</a><a href="/tags/tag1/" style="font-size: 10.00px;">tag1</a><a href="/tags/tag2/" style="font-size: 10.00px;">tag2</a><a href="/tags/tag3/" style="font-size: 10.00px;">tag3</a><a href="/tags/数据挖掘/" style="font-size: 13.33px;">数据挖掘</a><a href="/tags/机器学习/" style="font-size: 13.33px;">机器学习</a><a href="/tags/生活记录/" style="font-size: 16.67px;">生活记录</a><a href="/tags/翻译/" style="font-size: 13.33px;">翻译</a><a href="/tags/�鼮/" style="font-size: 10.00px;">�鼮</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/05/26/hiho1055/">hiho1055</a>
          </li>
        
          <li>
            <a href="/2015/05/25/hiho1174/">hiho1174</a>
          </li>
        
          <li>
            <a href="/2015/05/23/hiho1050/">hiho1050</a>
          </li>
        
          <li>
            <a href="/2015/05/22/hiho1049/">hiho1049</a>
          </li>
        
          <li>
            <a href="/2015/05/21/hiho1048/">hiho1048</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://youngyangyang.github.io/" target="_blank">Youngyangyang</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2484873700&verifier=44959cf7&dpc=1"></iframe>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Young Kun<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/Beeder/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
  
  <!-- 隐藏CNZZ图标 -->
  <div style="display:none">
	<!-- 此处粘贴站长统计代码 -->
  </div> 
  
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"youngyangyang"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script src="/js/script.js" type="text/javascript"></script>



  </div>
</body>
</html>